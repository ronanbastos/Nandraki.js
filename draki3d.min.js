class ThreeCore{constructor(){if(ThreeCore.instance)return ThreeCore.instance;this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new THREE.WebGLRenderer({alpha:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),ThreeCore.instance=this}init(e){e.appendChild(this.renderer.domElement),this.animate()}animate(){requestAnimationFrame(()=>this.animate()),this.scene.traverse(e=>{e.userData.scripts&&e.userData.scripts.forEach(t=>t(e));let t=e.userData.components||{};for(let r in t){let a=t[r];"function"==typeof a.update&&a.update(e)}}),this.renderer.render(this.scene,this.camera)}}class ThreeFactory{createLight(){return new THREE.PointLight(16777215,1)}createCube(){let e=new THREE.BoxGeometry,t=new THREE.MeshStandardMaterial({color:65280});return new THREE.Mesh(e,t)}createCamera(){return new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,1e3)}}class EntityBuilder{constructor(){this.entity=new THREE.Object3D}addMesh(e){return this.entity.add(e),this}setPosition(e,t,r){return this.entity.position.set(e,t,r),this}build(){return this.entity}}class PrototypeFactory{constructor(){this.prototypes={}}register(e,t){this.prototypes[e]=t}clone(e){return this.prototypes[e]?.clone()??null}}class ComponentRegistry{static components={};static register(e,t){this.components[e]=t}static instantiate(e,...t){let r=this.components[e];return r?new r(...t):null}}const TagSystem={add(e,t){e.userData.tags||(e.userData.tags=new Set),e.userData.tags.add(t)},has:(e,t)=>e.userData.tags?.has(t)??!1,remove(e,t){e.userData.tags?.delete(t)},getAll(e){let t=new ThreeCore,r=[];return t.scene.traverse(t=>{t.userData.tags?.has(e)&&r.push(t)}),r}};class Game{static create(e,t=null){let r=new ThreeFactory,a={cube:"createCube",camera:"createCamera",light:"createLight"}[e];if(!a||"function"!=typeof r[a])throw Error(`Tipo de objeto desconhecido: "${e}"`);let s=r[a]();return t&&(s.name=t),s}}function drak(e=null){let t=new ThreeCore;if(!e)return{byTag(e){let r=[];return t.scene.traverse(t=>{t.userData.tags?.has(e)&&r.push(drak(t.name))}),r}};let r=t.scene.getObjectByName(e);return r?{set(e,t){let a=e.split("."),s=r;for(;a.length>1;)s=s[a.shift()];s[a[0]]=t},get(e){let t=e.split("."),a=r;for(let s of t)a=a[s];return a},script(e){r.userData.scripts||(r.userData.scripts=[]),r.userData.scripts.push(e)},component:e=>r.userData?.components?.[e]??null,addComponent(e,t){r.userData.components||(r.userData.components={}),r.userData.components[e]=t},removeComponent(e){r.userData.components&&delete r.userData.components[e]},addTag(e){r.userData.tags||(r.userData.tags=new Set),r.userData.tags.add(e)},removeTag(e){r.userData.tags?.delete(e)},hasTag:e=>r.userData.tags?.has(e)??!1,echo(){console.log(r)},eye(){r.material&&r.material.color&&(r.userData.originalColor||(r.userData.originalColor=r.material.color.clone()),r.material.color.set(16776960),setTimeout(()=>{r.material&&r.userData.originalColor&&r.material.color.copy(r.userData.originalColor)},1e3))},callTo(e){let r=t.scene.getObjectByName(e);r&&console.log("Chamado:",r)},touch(e){let r=t.scene.getObjectByName(e);r?.userData.scripts&&r.userData.scripts.forEach(e=>e(r))},ref:e=>r.userData?.[e]??null,link(e){let a=t.scene.getObjectByName(e);a&&a.add(r)},pointTo(e){let a=t.scene.getObjectByName(e);a&&"function"==typeof r.lookAt&&r.lookAt(a.position)},hook(e){if("function"!=typeof e){console.warn(`hook: argumento n\xe3o \xe9 uma fun\xe7\xe3o v\xe1lida`);return}try{return e(r)}catch(t){console.error(`hook: erro ao executar fun\xe7\xe3o para "${r.name}"`,t)}}}:(console.warn(`Objeto "${e}" n\xe3o encontrado`),null)}
